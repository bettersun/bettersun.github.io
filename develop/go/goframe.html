<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GoFrame | 任何一种技艺达到完美 都会令人无法抗拒</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.995160dc.css" as="style"><link rel="preload" href="/assets/js/app.624f9a9f.js" as="script"><link rel="preload" href="/assets/js/2.d1d67354.js" as="script"><link rel="preload" href="/assets/js/13.77b1e855.js" as="script"><link rel="prefetch" href="/assets/js/10.45fe16c6.js"><link rel="prefetch" href="/assets/js/11.2866746f.js"><link rel="prefetch" href="/assets/js/12.61a7e1c4.js"><link rel="prefetch" href="/assets/js/14.c3263c7f.js"><link rel="prefetch" href="/assets/js/15.9197d47c.js"><link rel="prefetch" href="/assets/js/16.3867b95c.js"><link rel="prefetch" href="/assets/js/17.71c4044e.js"><link rel="prefetch" href="/assets/js/18.13ceb8a9.js"><link rel="prefetch" href="/assets/js/19.dff5aea5.js"><link rel="prefetch" href="/assets/js/20.e213e1af.js"><link rel="prefetch" href="/assets/js/21.7ccfdbb3.js"><link rel="prefetch" href="/assets/js/22.09dfd8e1.js"><link rel="prefetch" href="/assets/js/23.11faa8dd.js"><link rel="prefetch" href="/assets/js/24.915b05ac.js"><link rel="prefetch" href="/assets/js/25.2c8c8414.js"><link rel="prefetch" href="/assets/js/26.c787705c.js"><link rel="prefetch" href="/assets/js/27.82cfa043.js"><link rel="prefetch" href="/assets/js/28.3b895149.js"><link rel="prefetch" href="/assets/js/29.23a521cf.js"><link rel="prefetch" href="/assets/js/3.b3f590a5.js"><link rel="prefetch" href="/assets/js/30.01cb8290.js"><link rel="prefetch" href="/assets/js/31.6041e933.js"><link rel="prefetch" href="/assets/js/32.1e681ed6.js"><link rel="prefetch" href="/assets/js/33.4c70eaa2.js"><link rel="prefetch" href="/assets/js/34.f96a2ac2.js"><link rel="prefetch" href="/assets/js/35.aa888627.js"><link rel="prefetch" href="/assets/js/36.6bcd3a7c.js"><link rel="prefetch" href="/assets/js/37.67ff90a3.js"><link rel="prefetch" href="/assets/js/38.db8b152b.js"><link rel="prefetch" href="/assets/js/39.f126ed46.js"><link rel="prefetch" href="/assets/js/4.4a616a47.js"><link rel="prefetch" href="/assets/js/40.6fa53d87.js"><link rel="prefetch" href="/assets/js/41.89b38bf4.js"><link rel="prefetch" href="/assets/js/42.c13fd7fe.js"><link rel="prefetch" href="/assets/js/43.7f4b2e72.js"><link rel="prefetch" href="/assets/js/44.e26896e6.js"><link rel="prefetch" href="/assets/js/45.708925f2.js"><link rel="prefetch" href="/assets/js/5.04bba5d3.js"><link rel="prefetch" href="/assets/js/6.05dd84d7.js"><link rel="prefetch" href="/assets/js/7.1266bbbb.js"><link rel="prefetch" href="/assets/js/8.1b767c1a.js"><link rel="prefetch" href="/assets/js/9.a0ed9595.js">
    <link rel="stylesheet" href="/assets/css/0.styles.995160dc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">任何一种技艺达到完美 都会令人无法抗拒</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/innerpeace/" class="nav-link">
  平和
</a></div><div class="nav-item"><a href="/develop/" class="nav-link router-link-active">
  猿起
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于菜单" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/about/favirate.html" class="nav-link">
  收藏夹
</a></li><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  测试
</a></li><li class="dropdown-item"><!----> <a href="http://www.sunjiashu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  哪一站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/innerpeace/" class="nav-link">
  平和
</a></div><div class="nav-item"><a href="/develop/" class="nav-link router-link-active">
  猿起
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于菜单" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  关于
</a></li><li class="dropdown-item"><!----> <a href="/about/favirate.html" class="nav-link">
  收藏夹
</a></li><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  测试
</a></li><li class="dropdown-item"><!----> <a href="http://www.sunjiashu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  哪一站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/develop/" aria-current="page" class="sidebar-link">猿起</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>GoLang</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/develop/go/" aria-current="page" class="sidebar-link">GoLang</a></li><li><a href="/develop/go/goframe.html" aria-current="page" class="active sidebar-link">GoFrame</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/develop/go/goframe.html#简单api开发" class="sidebar-link">简单API开发</a></li><li class="sidebar-sub-header"><a href="/develop/go/goframe.html#使用controller" class="sidebar-link">使用Controller</a></li><li class="sidebar-sub-header"><a href="/develop/go/goframe.html#使用controller并调用service" class="sidebar-link">使用Controller并调用Service</a></li></ul></li><li><a href="/develop/go/go-astilectron.html" class="sidebar-link">go-astilectron</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ThreeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="goframe"><a href="#goframe" class="header-anchor">#</a> GoFrame</h1> <h2 id="简单api开发"><a href="#简单api开发" class="header-anchor">#</a> 简单API开发</h2> <ol><li><p>初始化项目</p> <p>本例使用xgo。<br>
新建xgo目录，然后进入目录后，执行命令 gf init xgo</p> <div class="language- extra-class"><pre class="language-text"><code>gf init xgo
</code></pre></div></li> <li><p>新建api</p> <p>本例机能使用 welcome。<br>
在./app/api目录下，新建机能目录。<br>
在新建的机能目录下新建api的代码文件。</p> <p>代码文件路径：<br>
./app/api/welcome/welcome.go</p> <p>代码内容：</p> <div class="language- extra-class"><pre class="language-text"><code>package welcome

import (
    &quot;github.com/gogf/gf/net/ghttp&quot;
)

// 
func Welcome(r *ghttp.Request) {
    r.Response.Writeln(&quot;Welcome to goframe!&quot;)
}
</code></pre></div><p>包名使用welcome。<br>
引入goframe封装的ghttp。<br>
编写API的处理函数，函数的参数是goframe封装的gttp.Request的指针。</p></li> <li><p>编写中间件</p> <p>本例编写一个跨域中间件<br>
在根目录下新建目录middleware。<br>
在middleware目录新建cors.go</p> <p>代码内容：</p> <div class="language- extra-class"><pre class="language-text"><code>package middleware

import &quot;github.com/gogf/gf/net/ghttp&quot;

// 允许接口跨域请求
func CORS(r *ghttp.Request) {
    r.Response.CORSDefault()
    r.Middleware.Next()
}
</code></pre></div></li> <li><p>注册路由</p> <p>默认的路由文件在./router/router.go中。</p> <p>官方示例中的说明：</p> <blockquote><p>// 你可以将路由注册放到一个文件中管理，<br>
// 也可以按照模块拆分到不同的文件中管理，<br>
// 但统一都放到router目录下。</p></blockquote> <p>本例先放在单一文件中。</p> <p>代码内容：</p> <div class="language- extra-class"><pre class="language-text"><code>package router

import (
    &quot;github.com/gogf/gf/frame/g&quot;
    &quot;github.com/gogf/gf/net/ghttp&quot;

    &quot;xgo/app/api/hello&quot;
    &quot;xgo/app/api/welcome&quot;

    &quot;xgo/middleware&quot;
)

func init() {
    s := g.Server()
    s.Group(&quot;/&quot;, func(group *ghttp.RouterGroup) {

        group.Middleware(middleware.CORS)

        group.ALL(&quot;/&quot;, hello.Hello)
        group.ALL(&quot;/welcome&quot;, welcome.Welcome)
    })
}

</code></pre></div></li> <li><p>运行服务</p> <div class="language- extra-class"><pre class="language-text"><code>go run main.go
</code></pre></div><p>运行服务后可在控制台看到所有服务的路由。</p></li> <li><p>访问URL</p> <p>访问 http://localhost:8199/welcome</p> <p>输出结果：</p> <div class="language- extra-class"><pre class="language-text"><code>Welcome to goframe!
</code></pre></div></li> <li><p>API返回JSON</p> <p>使用ghttp.Request.Response.WriteJson()方法返回JSON。<br>
修改 ./app/api/welcome/welcome.go</p> <div class="language- extra-class"><pre class="language-text"><code>package welcome

import (
    &quot;github.com/gogf/gf/net/ghttp&quot;
)

type WelcomeInfo struct {
    Message string `json:&quot;message&quot;`
}

func Welcome(r *ghttp.Request) {
    var welcomeInfo WelcomeInfo
    welcomeInfo.Message = &quot;Welcome to goframe!&quot;

    r.Response.WriteJson(welcomeInfo)
}
</code></pre></div><p>首先定义 WelcomeInfo 结构体，添加一个可导出属性Message，并指定json解析用键值。<br>
Welcome方法中，给WelcomeInfo实例的Message属性设定一个值。<br>
然后使用 ghttp.Request.Response.WriteJson() 返回JSON。</p> <p>访问URL后返回的原始数据为：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;Welcome to goframe!&quot;</span><span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="使用controller"><a href="#使用controller" class="header-anchor">#</a> 使用Controller</h2> <ol><li><p>添加Controller</p> <p>在./app/api/welcome/welcome.go里定义一个空的结构体Controller作为API管理对象。<br>
路由注册时只需要把Controller注册给 /welcome，然后所有Controller指针的导出函数都会自动映射到对应的URL。<br>
非导出函数不会被映射。</p> <p>映射规则：</p> <ul><li>函数名的首字母大写，映射到对应的URL的首字母小写。</li> <li>函数名中间的大写字母会映射为 短线+小写字母。</li></ul> <p>例：<br>
WelcomeMessage()函数映射的URL为 /welcome/welcome-message。</p> <p>例如：<br>
welcome.go里为Controller定义了一个方法：</p> <div class="language- extra-class"><pre class="language-text"><code>package welcome

import (
    &quot;github.com/gogf/gf/net/ghttp&quot;
)

type Controller struct{}

func (c *Controller) Come(r *ghttp.Request) {

    r.Response.Writeln(&quot;Come to goframe!&quot;)
}

</code></pre></div></li> <li><p>改变路由注册方式</p> <p>新建一个welcome的Controller实例。<br>
然后把这个Controller实例注册到 /welcome 。</p> <div class="language- extra-class"><pre class="language-text"><code>package router

import (
    &quot;github.com/gogf/gf/frame/g&quot;
    &quot;github.com/gogf/gf/net/ghttp&quot;

    &quot;xgo/app/api/hello&quot;
    &quot;xgo/app/api/welcome&quot;

    &quot;xgo/middleware&quot;
)

func init() {
    s := g.Server()
    s.Group(&quot;/&quot;, func(group *ghttp.RouterGroup) {

        ctlWelcome := new(welcome.Controller)

        group.Middleware(middleware.CORS)

        group.ALL(&quot;/&quot;, hello.Hello)
        group.ALL(&quot;/welcome&quot;, ctlWelcome)
    })
}
</code></pre></div></li> <li><p>运行服务</p> <p>运行服务后可在控制台看到所有服务的路由。<br>
可以看到，./app/api/welcome/welcome.go里Controller的Come函数自动注册到/welcome/come的URL。</p></li> <li><p>访问URL</p> <p>访问 http://localhost:8199/welcome/come</p> <p>输出结果：</p> <div class="language- extra-class"><pre class="language-text"><code>Come to goframe!
</code></pre></div></li></ol> <h2 id="使用controller并调用service"><a href="#使用controller并调用service" class="header-anchor">#</a> 使用Controller并调用Service</h2> <ol><li><p>新建Service用代码文件</p> <p>在./app/api/service目录下新建welcome目录，在welcome目录下新建welcome.go文件。</p> <p>代码路径：<br>
./app/api/service/welcome/welcome.go</p> <p>代码内容：</p> <div class="language- extra-class"><pre class="language-text"><code>package welcome

type WelcomeInfo struct {
    Message string `json:&quot;message&quot;`
}

func Message() string {
    return &quot;Welcome to goframe!&quot;
}

func Info() WelcomeInfo {

    var welcomeInfo WelcomeInfo
    welcomeInfo.Message = &quot;Welcome to goframe!&quot;

    return welcomeInfo
}
</code></pre></div></li> <li><p>在API文件Controller的函数中调用Service</p> <p>需要引入服务的机能包。</p> <div class="language- extra-class"><pre class="language-text"><code>package welcome

import (
    &quot;github.com/gogf/gf/net/ghttp&quot;

    &quot;xgo/app/service/welcome&quot;
)

type Controller struct{}

func (c *Controller) Message(r *ghttp.Request) {

    message := welcome.Message()
    r.Response.Writeln(message)
}

func (c *Controller) Info(r *ghttp.Request) {

    welcomeInfo := welcome.Info()
    r.Response.WriteJson(welcomeInfo)
}
</code></pre></div></li> <li><p>运行服务后访问URL确认。</p> <ul><li>访问 http://localhost:8199/welcome/message</li></ul> <p>输出结果：</p> <div class="language- extra-class"><pre class="language-text"><code>Welcome to goframe!
</code></pre></div><ul><li>访问 http://localhost:8199/welcome/info</li></ul> <p>输出结果：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;message&quot;</span><span class="token operator">:</span><span class="token string">&quot;Welcome to goframe!&quot;</span><span class="token punctuation">}</span>
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最新提交时间:</span> <span class="time">7/28/2020, 3:55:39 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/develop/go/" class="prev router-link-active">
        GoLang
      </a></span> <span class="next"><a href="/develop/go/go-astilectron.html">
        go-astilectron
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.624f9a9f.js" defer></script><script src="/assets/js/2.d1d67354.js" defer></script><script src="/assets/js/13.77b1e855.js" defer></script>
  </body>
</html>
